<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cargar Plan de Estudios</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FilePond CSS -->
    <link
      href="https://unpkg.com/filepond/dist/filepond.css"
      rel="stylesheet"
    />
    <style>
      /* FilePond Custom Styles for Dark Mode */
      .filepond--root {
        font-family: sans-serif;
        margin-bottom: 0;
      }
      .filepond--panel-root {
        background-color: rgba(55, 65, 81, 0.5); /* gray-700 with opacity */
        border: 2px dashed #4b5563; /* gray-600 */
      }
      .filepond--drop-label {
        color: #9ca3af; /* gray-400 */
      }
      .filepond--label-action {
        text-decoration-color: #818cf8; /* indigo-400 */
        color: #818cf8;
      }
      .filepond--credits {
        display: none;
      }

      /* Estilos para inputs manuales */
      input[type="text"],
      input[type="number"],
      select {
        width: 100%;
        background-color: #374151; /* gray-700 */
        border: 1px solid #4b5563; /* gray-600 */
        color: #ffffff; /* white */
        padding: 0.5rem 0.75rem;
        border-radius: 0.375rem;
        height: 2.75rem; /* Altura consistente */
        font-size: 0.875rem;
        line-height: 1.25rem;
      }
      select {
        appearance: none;
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%23ffffff' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
        background-position: right 0.75rem center;
        background-repeat: no-repeat;
        background-size: 1.5em 1.5em;
        padding-right: 2.5rem;
        color: #ffffff !important;
      }
      select option {
        background-color: #1f2937;
        color: #ffffff;
        padding: 0.5rem;
      }
      input:focus,
      select:focus {
        outline: none;
        border-color: #6366f1; /* indigo-500 */
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
      }

      @keyframes slideInFadeOut {
        0% {
          opacity: 0;
          transform: translateY(-20px);
        }
        10% {
          opacity: 1;
          transform: translateY(0);
        }
        80% {
          opacity: 1;
          transform: translateY(0);
        }
        100% {
          opacity: 0;
          transform: translateY(-20px);
          pointer-events: none;
        }
      }
      .animate-toast {
        animation: slideInFadeOut 5s ease-in-out forwards;
      }
    </style>
  </head>
  <body class="bg-gray-900 text-gray-100 font-sans">
    <div class="min-h-screen flex flex-col">
      <!-- Navbar -->
      <nav class="bg-gray-800 shadow-sm border-b border-gray-700">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div class="flex justify-between h-16 items-center">
            <div class="flex-shrink-0 flex items-center">
              <span class="text-2xl font-bold text-indigo-400"
                >游꿉 University Tracker</span
              >
            </div>
            <div>
              <a
                href="/"
                class="text-gray-300 hover:text-indigo-400 font-medium transition-colors duration-200"
              >
                Volver al Dashboard
              </a>
            </div>
          </div>
        </div>
      </nav>

      <!-- Main Content -->
      <main class="flex-grow container mx-auto px-4 py-10 max-w-3xl">
        <div
          class="bg-gray-800 shadow-lg rounded-xl p-8 border border-gray-700"
        >
          <header class="mb-8 border-b border-gray-700 pb-4">
            <h2 class="text-3xl font-bold text-white">Importar Materias</h2>
          </header>

          <!-- Toast Container -->
          {% if messages %}
          <div class="fixed top-5 right-5 z-50 flex flex-col gap-3">
            {% for message in messages %}
            <div
              class="animate-toast px-6 py-4 rounded-lg shadow-lg text-white font-medium flex items-center gap-3 min-w-[300px] {% if message.tags == 'error' %}bg-red-500{% elif message.tags == 'success' %}bg-green-500{% elif message.tags == 'warning' %}bg-yellow-500{% else %}bg-blue-500{% endif %}"
            >
              {% if message.tags == 'success' %}
              <svg
                class="w-6 h-6"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M5 13l4 4L19 7"
                ></path>
              </svg>
              {% elif message.tags == 'error' %}
              <svg
                class="w-6 h-6"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M6 18L18 6M6 6l12 12"
                ></path>
              </svg>
              {% else %}
              <svg
                class="w-6 h-6"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                ></path>
              </svg>
              {% endif %}

              <span>{{ message }}</span>
            </div>
            {% endfor %}
          </div>
          {% endif %}

          <div class="mb-8 text-gray-300">
            <p>
              Selecciona c칩mo deseas cargar las materias a tu plan de estudios.
              Puedes hacerlo de forma masiva subiendo un archivo CSV o agregar
              materias individualmente de forma manual.
            </p>
          </div>

          <!-- Tab Selection -->
          <div class="grid grid-cols-2 gap-4 mb-8">
            <button
              id="tab-csv"
              onclick="switchTab('csv')"
              class="flex items-center justify-center gap-3 p-4 rounded-lg border-2 transition-all duration-200 border-indigo-500 bg-indigo-900/20 text-white"
            >
              <svg
                class="w-6 h-6"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"
                ></path>
              </svg>
              <span class="font-bold">Carga Masiva (CSV)</span>
            </button>

            <button
              id="tab-manual"
              onclick="switchTab('manual')"
              class="flex items-center justify-center gap-3 p-4 rounded-lg border-2 border-gray-700 bg-gray-800 text-gray-400 hover:bg-gray-700 hover:text-gray-200 transition-all duration-200"
            >
              <svg
                class="w-6 h-6"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"
                ></path>
              </svg>
              <span class="font-bold">Carga Manual</span>
            </button>
          </div>

          <!-- CSV Section -->
          <div id="content-csv" class="block animate-fade-in">
            <div class="flex items-center gap-3 mb-6">
              <div
                class="flex items-center justify-center w-8 h-8 rounded-full bg-indigo-900 text-indigo-300 font-bold text-sm"
              >
                A
              </div>
              <h3 class="text-xl font-bold text-white">Carga Masiva (CSV)</h3>
            </div>

            <div
              class="bg-blue-900/20 border-l-4 border-blue-500 p-4 mb-6 rounded-r-lg"
            >
              <div class="flex">
                <div class="flex-shrink-0">
                  <svg
                    class="h-5 w-5 text-blue-400"
                    viewBox="0 0 20 20"
                    fill="currentColor"
                  >
                    <path
                      fill-rule="evenodd"
                      d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                      clip-rule="evenodd"
                    />
                  </svg>
                </div>
                <div class="ml-3">
                  <p class="text-sm text-blue-200">
                    Formato requerido:
                    <strong class="font-semibold text-white"
                      >A침o, Duraci칩n, Nombre</strong
                    >
                  </p>
                </div>
              </div>
            </div>

            <div class="grid grid-cols-2 gap-4 mb-6">
              <div
                class="bg-gray-700/30 p-3 rounded-lg border border-gray-600/50"
              >
                <h4 class="text-xs font-bold text-gray-400 uppercase mb-2">
                  A침o
                </h4>
                <ul class="text-sm text-gray-300 space-y-1">
                  <li>
                    <code class="bg-gray-700 px-1 rounded text-xs">1-6</code>
                    A침o carrera
                  </li>
                </ul>
              </div>
              <div
                class="bg-gray-700/30 p-3 rounded-lg border border-gray-600/50"
              >
                <h4 class="text-xs font-bold text-gray-400 uppercase mb-2">
                  Duraci칩n
                </h4>
                <ul class="text-sm text-gray-300 space-y-1">
                  <li>
                    <code class="bg-gray-700 px-1 rounded text-xs">0</code>
                    Anual
                  </li>
                  <li>
                    <code class="bg-gray-700 px-1 rounded text-xs">1</code> 1춿
                    Cuat.
                  </li>
                  <li>
                    <code class="bg-gray-700 px-1 rounded text-xs">2</code> 2춿
                    Cuat.
                  </li>
                </ul>
              </div>
            </div>

            <div class="mb-6">
              <p class="text-xs text-gray-500 uppercase font-bold mb-2">
                Ejemplo CSV:
              </p>
              <div
                class="bg-gray-900 text-gray-300 p-3 rounded-lg font-mono text-sm border border-gray-700"
              >
                1, 0, An치lisis Matem치tico I
              </div>
            </div>

            <form method="post" enctype="multipart/form-data" class="space-y-6">
              {% csrf_token %}
              <div class="space-y-2">
                <label class="block text-sm font-medium text-gray-300"
                  >Seleccionar archivo</label
                >
                {{ form.archivo }}
                <p class="text-xs text-gray-500 mt-1">M치ximo 10MB</p>
              </div>
              <button
                type="submit"
                class="w-full flex justify-center py-2.5 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-all duration-200"
              >
                Subir CSV
              </button>
            </form>
          </div>

          <!-- Manual Section -->
          <div id="content-manual" class="hidden animate-fade-in">
            <div class="flex items-center gap-3 mb-6">
              <div
                class="flex items-center justify-center w-8 h-8 rounded-full bg-emerald-900 text-emerald-300 font-bold text-sm"
              >
                B
              </div>
              <h3 class="text-xl font-bold text-white">Carga Manual</h3>
            </div>

            <p class="text-gray-400 text-sm mb-6">
              Agrega una materia individualmente completando el siguiente
              formulario.
            </p>

            <form method="post" class="space-y-5">
              {% csrf_token %} {% for field in form_manual %}
              <div>
                <label
                  for="{{ field.id_for_label }}"
                  class="block text-sm font-medium text-gray-300 mb-1.5"
                >
                  {{ field.label }}
                </label>
                {{ field }} {% if field.help_text %}
                <p class="text-xs text-gray-500 mt-1.5">
                  {{ field.help_text }}
                </p>
                {% endif %} {% if field.errors %}
                <div class="text-red-400 text-xs mt-1.5">
                  {{ field.errors }}
                </div>
                {% endif %}
              </div>
              {% endfor %}

              <div class="pt-2">
                <button
                  type="submit"
                  class="w-full flex justify-center py-2.5 px-4 border border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-300 bg-gray-800 hover:bg-gray-700 hover:text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-all duration-200"
                >
                  Agregar Materia
                </button>
              </div>
            </form>
          </div>

          <!-- FilePond JS -->
          <script src="https://unpkg.com/filepond/dist/filepond.js"></script>
          <script>
            // Tab Switching Logic
            function switchTab(tab) {
              const tabCsv = document.getElementById("tab-csv");
              const tabManual = document.getElementById("tab-manual");
              const contentCsv = document.getElementById("content-csv");
              const contentManual = document.getElementById("content-manual");

              if (tab === "csv") {
                // Activate CSV
                tabCsv.className =
                  "flex items-center justify-center gap-3 p-4 rounded-lg border-2 transition-all duration-200 border-indigo-500 bg-indigo-900/20 text-white";
                tabManual.className =
                  "flex items-center justify-center gap-3 p-4 rounded-lg border-2 border-gray-700 bg-gray-800 text-gray-400 hover:bg-gray-700 hover:text-gray-200 transition-all duration-200";

                contentCsv.classList.remove("hidden");
                contentManual.classList.add("hidden");
              } else {
                // Activate Manual
                tabManual.className =
                  "flex items-center justify-center gap-3 p-4 rounded-lg border-2 transition-all duration-200 border-emerald-500 bg-emerald-900/20 text-white";
                tabCsv.className =
                  "flex items-center justify-center gap-3 p-4 rounded-lg border-2 border-gray-700 bg-gray-800 text-gray-400 hover:bg-gray-700 hover:text-gray-200 transition-all duration-200";

                contentManual.classList.remove("hidden");
                contentCsv.classList.add("hidden");
              }
            }

            // FilePond Logic
            // Registrar el plugin si quisieras validar tipos, etc.
            // FilePond.registerPlugin(FilePondPluginFileValidateType);

            // Obtener el input
            const inputElement = document.querySelector("#id_archivo");

            if (inputElement) {
              // Crear la instancia de FilePond
              const pond = FilePond.create(inputElement, {
                labelIdle:
                  'Arrastra y suelta tu archivo o <span class="filepond--label-action">Examina</span>',
                storeAsFile: true, // Importante para que funcione con form submit est치ndar de Django
                credits: false,
                stylePanelLayout: "compact",
                styleLoadIndicatorPosition: "center bottom",
                styleProgressIndicatorPosition: "right bottom",
                styleButtonRemoveItemPosition: "left bottom",
                styleButtonProcessItemPosition: "right bottom",
              });
            } else {
              console.error("No se encontr칩 el input de archivo (#id_archivo)");
            }
          </script>
        </div>
      </main>
    </div>
  </body>
</html>
